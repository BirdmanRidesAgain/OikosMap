nextflow_pipeline {

    name "Test input checking in OikosMap.nf"
    script "OikosMap.nf"

    test("Should exit cleanly if --help flag is set") {
        when {
            params {
                help = true
                indlist = "null"
                indir = "null"
                refseq = "null"
            }
        }
        then {
            assert workflow.exitStatus == 10
        }
    }
    test("Should throw error if inputs are missing") {
        when {
            params {
                indlist = "null"
                indir = "null"
                refseq = "null"
            }
        }
        then {
            assert workflow.exitStatus != 0
        }
    }
    test("Should throw error if --indir does not exist") {
        when {
            params {
                indlist = "$baseDir/testdata/indlist.txt"
                indir = "$baseDir/fake/directory"
                refseq = "$baseDir/testdata/refseq/Chlamydotis_macqueenii_Ctg1_15kbp.fa"
            }
        }
        then {
            assert workflow.exitStatus != 0
        }
    }
    test("Should throw error if --refseq does not exist") {
        when {
            params {
                indlist = "$baseDir/testdata/indlist.txt"
                indir = "$baseDir/testdata/readfiles"
                refseq = "$baseDir/fake/refseq.fa"
            }
        }
        then {
            assert workflow.exitStatus != 0
        }
    }
    test("Should execute complete pipeline using testdata") {
        when {
            params {
                indlist = "$baseDir/testdata/indlist.txt"
                indir = "$baseDir/testdata/readfiles"
                refseq = "$baseDir/testdata/refseq/Chlamydotis_macqueenii_Ctg1_15kbp.fa"
            }
        }
        then {
            assert workflow.success
        }
    }
}